# 入门

## 环境搭建

- `npm i -D webpack webpack-cli`。

> 其中 `-D` 是 `--save-dev` 的缩写，`-S` 是 `--save` 的缩写。
> `-D` 会把依赖包安装到 `package.json` 中的 `devDependencies`， `-S` 则把依赖包安装到 `dependencies` 中。 `devDependencies` 中的包是开发环境时的依赖包，到了正式生产环境则不需要用到了。`dependencies` 中的包则在生产环境中依旧要用到。


## webpack 基本配置

```js
// webpack.config.js

const path = require('path');
module.exports = {
  mode: 'development', // 开发模式
  entry: path.resolve(__dirname, '../src/main.js'),    // 入口文件。也可以是一个对象支持多个入口文件，键名为模块名
  output: { // 出口配置
    filename: 'output.js',      // 打包后的文件名称
    path: path.resolve(__dirname, '../dist')  // 打包后的目录
  }
}
```

### 打包后的文件名带哈希值

``` js
output: {
  filename: '[name].[hash:8].js'
}
```

- 原因：在打包出来的文件名上加上文件内容的 hash，主要是为了有效使用浏览器长缓存。JS 文件如果有内容更新，hash 就会更新，浏览器请求路径变化所以更新缓存；如果 JS 内容不变，hash 也不会改变，则直接用缓存。



## 插件

### 自动引入打包后的文件

- 安装：`npm i -D html-webpack-plugin`。

- webpack.config.js 配置：

```js
const HtmlWebpackPlugin = require('html-webpack-plugin')

plugins:[
  new HtmlWebpackPlugin({
    template: path.resolve(__dirname, '../public/index.html')
  })
]
```

- 作用：打包 template 中指定的 HTML 文件，并在打包后的 HTML 文件中自动引入打包后的 JS 文件。这样就可以不用每次打包 JS 文件后，由于 JS 文件名的哈希值发生变化了而修改 HTML 文件中 JS 的引入名了。

- 如果有多个入口文件，则可以使用多个 HtmlWebpackPlugin 实例，分别对应不同的入口文件。

```js
module.exports = {
  mode:'development',
  entry: {
    main: path.resolve(__dirname, '../src/main.js'),
    header: path.resolve(__dirname, '../src/header.js')
  }, 
  output: {
    filename: '[name].[hash:8].js',
    path: path.resolve(__dirname, '../dist')
  },
  plugins:[
    new HtmlWebpackPlugin({
      template: path.resolve(__dirname, '../public/index.html'),
      filename: 'index.html',
      chunks: ['main']  // 与入口文件对应的模块名
    }),
    new HtmlWebpackPlugin({
      template:  path.resolve(__dirname, '../public/header.html'),
      filename: 'header.html',
      chunks: ['header'] 
    }),
  ]
}
```

### 清除上次遗留的打包文件

- 安装：`npm install -D clean-webpack-plugin`。

- webpack.config.js 配置：

```js
plugins: [
  new CleanWebpackPlugin()
]
```

### 解析 CSS

- 安装：
  - 解析 CSS：`npm i -D style-loader css-loader`。
  - 解析 Less：`npm i -D less less-loader`。

- webpack.config.js 配置：

```js
module: {
  rules: [
    {
      test: /\.css$/,
      use: ['style-loader', 'css-loader'] 
    },
    {
      test: /\.less$/,
      use: ['style-loader', 'css-loader', 'less-loader'] 
    }
  ]
}
```

- 说明：loader 的解析是从右向左的。执行时先用 css-loader 将 CSS 文件转成对象，传递给 style-loader 插入到 head 的 style 中。如果是用 Less 的话，则需要先将 Less 转换成 Css。

### 将 CSS 单独打包到一个文件中

#### 使用 `mini-css-extract-plugin` 插件（推荐）

> [参考文档](https://webpack.js.org/plugins/mini-css-extract-plugin/)

- 安装：`npm i -D mini-css-extract-plugin`。

- webpack.config.js 配置：

```js
const MiniCssExtractPlugin = require("mini-css-extract-plugin");

module.exports = {
  plugins: [
    new MiniCssExtractPlugin({
      filename: "[name].[hash].css",
      chunkFilename: "[id].css",
    })
  ],
  module: {
    rules: [
      {
        test: /\.(c|le)ss$/,
        use: [
          MiniCssExtractPlugin.loader,
          'css-loader',
          'less-loader'
        ]
      }
    ]
  }
}
```

- 说明：使用 loader 打包 CSS 时，默认是将 CSS 打包到对应的 JS 文件里面去的，所以页面加载的时候会先解析完了 JS 之后再去加载 CSS，会影响用户体验。使用 `mini-css-extract-plugin` 或 `extract-text-webpack-plugin` 插件可以把入口文件里引用到的 CSS 文件单独打包成一个文件，并自动引入到打包后的 HTML 文件中。


#### 使用 `extract-text-webpack-plugin` 插件

> [参考文档](https://webpack.docschina.org/plugins/extract-text-webpack-plugin/)

- 安装：`npm i extract-text-webpack-plugin@next`。

- webpack.config.js 配置：

```js
const ExtractTextPlugin = require("extract-text-webpack-plugin")

module.exports = {
  plugins: [
    new ExtractTextPlugin("css/[name].css") // 指定打包后的 CSS 文件位置，相对于出口路径而言，并可以指定文件名
  ],
  module: {
    rules: [
      {
        test: /\.css|.less$/,
        use: ExtractTextPlugin.extract({
          fallback: 'style-loader',
          use: 'css-loader'
        })      
      }
    ]
  }
}
```

- 说明：`extract-text-webpack-plugin` 插件可以将引入的多个 CSS 文件一一打包成多个对应的 CSS 文件。`mini-css-extract-plugin` 插件只能打包成一个 CSS 文件。


### CSS 自动添加浏览器前缀

- 安装：`npm i -D postcss-loader autoprefixer`。

- webpack.config.js 配置：

```js
module.exports = {
  rules: [{
    test: /\.css|.less$/,
    use: ExtractTextPlugin.extract({
      fallback: 'style-loader',
      use: ['css-loader', { 
        loader: 'postcss-loader', 
          options: {
            plugins: [
              require('autoprefixer') ({
                // 要适配的浏览器
                overrideBrowserslist: [
                  "defaults",
                  "not ie < 11",
                  "last 2 versions",
                  "> 1%",
                  "iOS 7",
                  "last 3 iOS versions"
                ]
              })
            ]
          }
        },
        'less-loader'
      ]
    })      
  }]
}
```



## TODO：
- 文件名添加哈希原理 <!-- https://www.cnblogs.com/luozhihao/p/6287820.html -->
- 解析图片 https://juejin.im/post/5d4bdb976fb9a06add4e192b#heading-3


- blog 阅读
  - https://www.cnblogs.com/cangqinglang/p/8715254.html